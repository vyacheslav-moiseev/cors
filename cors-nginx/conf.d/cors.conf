# cors.conf — безопасный CORS без использования if

# final origin будет найден заранее через map в nginx.conf
add_header Access-Control-Allow-Origin $final_cors_origin always;
add_header Access-Control-Allow-Credentials "true" always;
add_header Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE, PATCH" always;
add_header Access-Control-Allow-Headers "Authorization, Content-Type, Accept, X-Requested-With" always;

# Preflight запросы
# OPTIONS можно обрабатывать так — это разрешено в server {}
location / {
	# если OPTIONS — сразу 204
	if ($request_method = OPTIONS) {
		return 204;
	}

	# иначе — нормальный ответ
	try_files $uri $uri/ =404;
}
